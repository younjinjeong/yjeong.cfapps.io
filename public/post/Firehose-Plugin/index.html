<!DOCTYPE html>
<html class="bg-dark-10">




<head>
  <meta charset="utf-8">
  <title> Using the Cloud Foundry Firehose Plugin &middot; Pivotal Engineering Journal </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/pivotal-ui.css">
  <link rel="stylesheet" href="/styleguide.css">
  <link rel="stylesheet" href="/github.css">
  <link rel="stylesheet" href="/local.css">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  
  <link href="http://feeds.feedburner.com/PivotalEngineeringJournal" rel="alternate" type="application/rss+xml" title="Pivotal Engineering Journal" />
</head>


<body>
  <div class="container">
  <div id="single-banner" class="pbxxl">
    <div class="single-banner-inner"></div>
    <p class="txt-c mvn">
      <a href="/">
        <svg x="0px" y="0px" width="200px" viewBox="0 0 435 180">
          <rect fill="#01786E" width="435" height="180"/>
          <path fill="#FFFFFF" d="M138.9,65h-11V54.4h11V65z M138.9,125.5h-11V72.8h11V125.5z"/>
          <path fill="#FFFFFF" d="M202.2,72.8l-15.3,45.5c-2.6,7.4-7.3,8.4-11.1,8.4c-5.6,0-9-2.6-11-8.4l-12.7-37.8h-5v-7.7h13.2
          l13.1,42.3c0.6,1.8,0.9,2.9,2.5,2.9c1.7,0,2-1.1,2.5-2.9l13.4-42.3H202.2z"/>
          <path fill="#FFFFFF" d="M229.3,72.8c14.2,0,24.1,9.4,24.1,22.8v8.3c0,13.4-9.9,22.8-24.1,22.8c-14.2,0-24.1-9.4-24.1-22.8
          v-8.3C205.1,82.2,215.1,72.8,229.3,72.8 M229.3,118c8.5,0,13.8-6.4,13.8-14.1v-8.3c0-7.7-5.2-14.1-13.8-14.1
          c-9,0-13.8,6.4-13.8,14.1v8.3C215.5,111.6,220.5,118,229.3,118"/>
          <path fill="#FFFFFF" d="M341,74.5c-5.5-1.4-14-2.4-20.3-2.4c-14.4,0-23.4,9.1-23.4,23.7v5.8c0,14.6,8.9,23.9,23.4,23.9
          c0.3,0,2.9,0,4.1-0.1v-8.8c-0.4,0-3.7,0.1-4.1,0.1c-7.8,0-13.1-6-13.1-15v-5.8c0-9,5.3-15,13.1-15c3.5,0,8.9,0.3,10.8,0.7
          l0.6,0.1l0,43.9h11V76.3C343,75.4,343,75,341,74.5"/>
          <rect x="353.6" y="54.4" fill="#FFFFFF" width="11" height="71"/>
          <path fill="#FFFFFF" d="M89.7,54.4H70.5v71h11.4V64.3h6.7c1.4,0,2.6,0.1,3.8,0.1c9.9,0.2,14.7,4.1,14.7,11.8
          c0,0.3,0,0.5,0,0.8c0,7.1-3.9,11.8-14.7,11.8c-1,0-2.1,0-3.2,0c0,2.7,0,7.8,0,9.5c1.1,0.1,2.2,0.1,3.2,0.1
          c15.5,0,26.4-6.1,26.4-21.4c0-0.3,0-0.6,0-0.9C118.9,60.4,107,54.4,89.7,54.4"/>
          <path fill="#FFFFFF" d="M272.8,61.5v11.3h17.9v8.5h-17.9V112c0,4.8,3.1,4.9,7.5,4.9h10.4v8.5h-14c-10.4,0-15-4.1-15-13.5V63
          L272.8,61.5z"/>
          <path fill="#FFFFFF" d="M369.6,120.9c0-2.5,2-4.6,4.6-4.6c2.5,0,4.6,2.1,4.6,4.6c0,2.5-2,4.6-4.6,4.6
          C371.6,125.5,369.6,123.4,369.6,120.9z M374.2,116.9c-2.2,0-3.9,1.8-3.9,3.9c0,2.1,1.7,3.9,3.9,3.9c2.2,0,3.9-1.8,3.9-3.9
          C378.1,118.7,376.3,116.9,374.2,116.9z M373.2,123.3h-0.5v-5c0,0,1.4,0,1.4,0c1.3,0,1.9,0.6,1.9,1.5c0,0.7-0.4,1.2-1,1.4l1.3,2.1
          h-0.6l-1.2-1.9l-1.2,0.1V123.3z M374.1,120.9c0.8,0,1.3-0.4,1.3-1.1c0-0.7-0.4-1.1-1.4-1.1c0,0-0.8,0-0.8,0v2.2L374.1,120.9z"/>
        </svg>
      </a>
    </p>
    <div class="container txt-c mvxl">
      <h1 class="title type-dark-9 mvn" id="main-title"><a href="/" class="type-dark-11 em-low title">Pivotal Engineering Journal</a></h1>
      <h3 class="type-dark-9 mvn">Technical articles from Pivotal engineers.</h3>
      
    </div>
  </div>
</div>

  <div class="container">
    <div id="post" class="bg-neutral-11 pbxxxl">
      <div class="post-header">
        <div class="phxxl pvl">
          <h1 class="title em-low type-dark-1 mvn">
            
            Using the Cloud Foundry Firehose Plugin
          </h1>
          <h2 class="h3 type-dark-3 em-default mvn post-summary">Get your Cloud Foundry Firehose logs and metrics straight to your fingertips.</h2>
          <div class="type-dark-5 em-default">
            Posted on
            <span class="post-date"> Tue, Oct 20, 2015 </span>
            
            
            by
            <ul class="authors">
            
              
                <li>
                  
                    <a href="https://twitter.com/warren_ff">Warren Fernandes</a>
                  
                </li>
              
            
            </ul>
            <br>
            
              Categories: &nbsp;
                
                  <a href="/categories/firehose">Firehose</a> &nbsp;&nbsp;
                
                  <a href="/categories/loggregator">Loggregator</a> &nbsp;&nbsp;
                
                  <a href="/categories/cf-cli">CF CLI</a> &nbsp;&nbsp;
                
                  <a href="/categories/logging--metrics">Logging &amp; Metrics</a> &nbsp;&nbsp;
                
                <br/>
              </span>
            
            <a href="https://github.com/pivotal-cf/blog/edit/master/content/post/Firehose-Plugin.md" class="type-sm">Edit this post on GitHub.</a>
            <div class="pull-right">
              <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="warren_ff ">Tweet</a>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </div>
          </div>
          <hr />
        </div>
      </div>
      <div class="panel-body phxxl pvn">
        

<h2 id="firehose-at-your-fingertips:e6d881032b6de5db24c59b1920a4ff8d">Firehose at your fingertips</h2>

<p>On the Logging and Metrics team, we recently found ourselves in a need to debug the CF Firehose more easily and we wanted to share that tool with all CF operators out there. In case you don&rsquo;t know what the Firehose is, let me tell you: It is undoubtedly the most powerful feature added to the CF logging system in the last 2 years. That&rsquo;s why its typically also restricted to be used by just the admin users. You know the saying &lsquo;With great power comes great bragging rights&rdquo; (or something like that).</p>

<h3 id="what-is-the-firehose:e6d881032b6de5db24c59b1920a4ff8d">What is the firehose?</h3>

<p>In all seriousness, the Firehose can be very useful. It is a stream of all application logs and all component metrics from the CF components. Unfortunately, so far it has been really difficult to access (you had to write some code in go to get access to that stream). But with our brand new Firehose CLI plugin, all you have to do is install the plugin from the plugin repository and you are good to go.</p>



  <figure class="center visible-lg">
      
          <img src="/images/loggregator/diagram.gif"  />
      
      
  </figure>
  <figure class="hidden-lg">
      
          <img src="/images/loggregator/diagram.gif"  class="img-responsive" />
      
      
  </figure>




<h3 id="how-can-i-obtain-admin-access:e6d881032b6de5db24c59b1920a4ff8d">How can I obtain admin access?</h3>

<p>As mentioned earlier, you need either admin access or some special permission to access the Firehose. Fortunately, the Loggregator <a href="https://github.com/cloudfoundry/loggregator/#configuring-the-firehose">README</a> provides good details on how to set this up.</p>

<h3 id="how-do-i-install-the-plugin:e6d881032b6de5db24c59b1920a4ff8d">How do I install the plugin?</h3>

<p>Installing, the plugin is really simple.</p>

<ol>
<li><p>Login to the CF CLI with your admin creds</p>

<pre><code class="language-bash">cf api &lt;your_cf_api_url&gt;
cf login
</code></pre></li>

<li><p>Add the plugin repository</p>

<pre><code class="language-bash">cf add-plugin-repo CF-Community http://plugins.cloudfoundry.org/
</code></pre></li>

<li><p>Install the plugin</p>

<pre><code class="language-bash">cf install-plugin &quot;Firehose Plugin&quot; -r CF-Community
</code></pre></li>
</ol>

<h3 id="how-do-i-use-the-firehose-plugin:e6d881032b6de5db24c59b1920a4ff8d">How do I use the Firehose plugin?</h3>

<p>There are two ways of using the plugin. There is an interactive mode and non-interactive mode.</p>

<p>The interactive mode requires some user input and will look something like below. You may select the type of messages you&rsquo;d like to have streaming on your terminal by selecting an index. If you are curious as to why it doesn&rsquo;t start with 1, look <a href="https://github.com/cloudfoundry/dropsonde-protocol/blob/master/events/envelope.proto#L13">here</a> and <a href="https://github.com/cloudfoundry/firehose-plugin/blob/master/firehose/client.go#L85">here</a></p>

<pre><code class="language-no-language">$ cf nozzle
What type of firehose messages do you want to see?
Please enter one of the following choices:
    hit 'enter' for all messages
    2 for HttpStart
    3 for HttpStop
    4 for HttpStartStop
    5 for LogMessage
    6 for ValueMetric
    7 for CounterEvent
    8 for Error
    9 for ContainerMetric
  &gt; 5
Starting the nozzle
Hit Ctrl+c to exit
</code></pre>

<p>You can also use the <code>--filter</code> flag to have the plugin operate without user interaction. For example, if you want to filter the log stream to contain just counter events then you can run the command like this <code>cf nozzle --filter CounterEvent</code></p>

<p>If you want all logs and not automatically enter interactive mode, you can pass in the <code>--no-filter</code> flag. This is the same as hitting enter in the interactive mode.</p>

<h3 id="share-the-load:e6d881032b6de5db24c59b1920a4ff8d">Share the load</h3>

<p>So the Firehose has this nifty feature where the logs can be distributed across various sessions in order to reduce load. All you need to do is use the same subscription ID for each session. So what that means is, if you have two terminal windows open and you run the following command <code>cf nozzle --no-filter --subscription-id zaphod</code> the load would be split evenly among the two sessions. Although having two heads didn&rsquo;t seem to help Zaphod anyways.</p>

<h3 id="don-t-panic:e6d881032b6de5db24c59b1920a4ff8d">Don&rsquo;t Panic</h3>

<p>In case you get any errors, just hold on to your towel.</p>

<table>
<thead>
<tr>
<th>Error</th>
<th>Solution</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>Unauthorized error: You are not authorized. Error: Invalid authorization</strong></td>
<td>Just regenerate your auth-token like so: <code>cf oauth-token</code></td>
</tr>

<tr>
<td><strong>Unable to recognize filter HtttpStarrrt</strong></td>
<td>Check your spelling</td>
</tr>

<tr>
<td><strong>Invalid filter choice</strong></td>
<td>Check your index choice. Enter a number from 2 through 9</td>
</tr>
</tbody>
</table>

<h3 id="how-we-use-this-plugin:e6d881032b6de5db24c59b1920a4ff8d">How we use this plugin?</h3>

<p>We use <code>cf nozzle -n</code> primarily for debugging and acceptance purposes. It&rsquo;s a quick way to look for expected component and application logs. Recently, our PM used this tool to look for logs originating from the DEA after pushing an app to PCF. Before this tool, he would have had to</p>

<ol>
<li>Setup his GOPATH and <code>go get</code> the <a href="https://github.com/cloudfoundry/noaa">NOAA</a> library.</li>
<li>Set up the environment variables CF_ACCESS_TOKEN and DOPPLER_ADDR.</li>
<li>Follow instructions to build and run the firehose sample.</li>
</ol>

      </div>
    </div>
  </div>
  <link rel="stylesheet" href="/css/highlight-github.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
