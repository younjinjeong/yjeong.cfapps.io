<!DOCTYPE html>
<html class="bg-dark-10">




<head>
  <meta charset="utf-8">
  <title> Setting up Kotlin with Android and tests &middot; Pivotal Engineering Journal </title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/pivotal-ui.css">
  <link rel="stylesheet" href="/styleguide.css">
  <link rel="stylesheet" href="/github.css">
  <link rel="stylesheet" href="/local.css">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  
  <link href="http://feeds.feedburner.com/PivotalEngineeringJournal" rel="alternate" type="application/rss+xml" title="Pivotal Engineering Journal" />
</head>


<body>
  <div class="container">
  <div id="single-banner" class="pbxxl">
    <div class="single-banner-inner"></div>
    <p class="txt-c mvn">
      <a href="/">
        <svg x="0px" y="0px" width="200px" viewBox="0 0 435 180">
          <rect fill="#01786E" width="435" height="180"/>
          <path fill="#FFFFFF" d="M138.9,65h-11V54.4h11V65z M138.9,125.5h-11V72.8h11V125.5z"/>
          <path fill="#FFFFFF" d="M202.2,72.8l-15.3,45.5c-2.6,7.4-7.3,8.4-11.1,8.4c-5.6,0-9-2.6-11-8.4l-12.7-37.8h-5v-7.7h13.2
          l13.1,42.3c0.6,1.8,0.9,2.9,2.5,2.9c1.7,0,2-1.1,2.5-2.9l13.4-42.3H202.2z"/>
          <path fill="#FFFFFF" d="M229.3,72.8c14.2,0,24.1,9.4,24.1,22.8v8.3c0,13.4-9.9,22.8-24.1,22.8c-14.2,0-24.1-9.4-24.1-22.8
          v-8.3C205.1,82.2,215.1,72.8,229.3,72.8 M229.3,118c8.5,0,13.8-6.4,13.8-14.1v-8.3c0-7.7-5.2-14.1-13.8-14.1
          c-9,0-13.8,6.4-13.8,14.1v8.3C215.5,111.6,220.5,118,229.3,118"/>
          <path fill="#FFFFFF" d="M341,74.5c-5.5-1.4-14-2.4-20.3-2.4c-14.4,0-23.4,9.1-23.4,23.7v5.8c0,14.6,8.9,23.9,23.4,23.9
          c0.3,0,2.9,0,4.1-0.1v-8.8c-0.4,0-3.7,0.1-4.1,0.1c-7.8,0-13.1-6-13.1-15v-5.8c0-9,5.3-15,13.1-15c3.5,0,8.9,0.3,10.8,0.7
          l0.6,0.1l0,43.9h11V76.3C343,75.4,343,75,341,74.5"/>
          <rect x="353.6" y="54.4" fill="#FFFFFF" width="11" height="71"/>
          <path fill="#FFFFFF" d="M89.7,54.4H70.5v71h11.4V64.3h6.7c1.4,0,2.6,0.1,3.8,0.1c9.9,0.2,14.7,4.1,14.7,11.8
          c0,0.3,0,0.5,0,0.8c0,7.1-3.9,11.8-14.7,11.8c-1,0-2.1,0-3.2,0c0,2.7,0,7.8,0,9.5c1.1,0.1,2.2,0.1,3.2,0.1
          c15.5,0,26.4-6.1,26.4-21.4c0-0.3,0-0.6,0-0.9C118.9,60.4,107,54.4,89.7,54.4"/>
          <path fill="#FFFFFF" d="M272.8,61.5v11.3h17.9v8.5h-17.9V112c0,4.8,3.1,4.9,7.5,4.9h10.4v8.5h-14c-10.4,0-15-4.1-15-13.5V63
          L272.8,61.5z"/>
          <path fill="#FFFFFF" d="M369.6,120.9c0-2.5,2-4.6,4.6-4.6c2.5,0,4.6,2.1,4.6,4.6c0,2.5-2,4.6-4.6,4.6
          C371.6,125.5,369.6,123.4,369.6,120.9z M374.2,116.9c-2.2,0-3.9,1.8-3.9,3.9c0,2.1,1.7,3.9,3.9,3.9c2.2,0,3.9-1.8,3.9-3.9
          C378.1,118.7,376.3,116.9,374.2,116.9z M373.2,123.3h-0.5v-5c0,0,1.4,0,1.4,0c1.3,0,1.9,0.6,1.9,1.5c0,0.7-0.4,1.2-1,1.4l1.3,2.1
          h-0.6l-1.2-1.9l-1.2,0.1V123.3z M374.1,120.9c0.8,0,1.3-0.4,1.3-1.1c0-0.7-0.4-1.1-1.4-1.1c0,0-0.8,0-0.8,0v2.2L374.1,120.9z"/>
        </svg>
      </a>
    </p>
    <div class="container txt-c mvxl">
      <h1 class="title type-dark-9 mvn" id="main-title"><a href="/" class="type-dark-11 em-low title">Pivotal Engineering Journal</a></h1>
      <h3 class="type-dark-9 mvn">Technical articles from Pivotal engineers.</h3>
      
    </div>
  </div>
</div>

  <div class="container">
    <div id="post" class="bg-neutral-11 pbxxxl">
      <div class="post-header">
        <div class="phxxl pvl">
          <h1 class="title em-low type-dark-1 mvn">
            
            Setting up Kotlin with Android and tests
          </h1>
          <h2 class="h3 type-dark-3 em-default mvn post-summary">First impressions of Kotlin</h2>
          <div class="type-dark-5 em-default">
            Posted on
            <span class="post-date"> Wed, Nov 11, 2015 </span>
            
            
            by
            <ul class="authors">
            
              
                <li>
                  
                    <a href="https://twitter.com/lauraallora">Laura Kogler</a>
                  
                </li>
              
            
            </ul>
            <br>
            
              Categories: &nbsp;
                
                  <a href="/categories/kotlin">Kotlin</a> &nbsp;&nbsp;
                
                  <a href="/categories/android">Android</a> &nbsp;&nbsp;
                
                <br/>
              </span>
            
            <a href="https://github.com/pivotal-cf/blog/edit/master/content/post/setting-up-kotlin-with-android-and-tests.md" class="type-sm">Edit this post on GitHub.</a>
            <div class="pull-right">
              <a href="https://twitter.com/share" class="twitter-share-button"{count} data-via="lauraallora ">Tweet</a>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </div>
          </div>
          <hr />
        </div>
      </div>
      <div class="panel-body phxxl pvn">
        

<p>I recently heard about <a href="https://kotlinlang.org/">Kotlin</a> with the release of their 1.0 Beta last week. Kotlin is a modern programming language that runs in the JVM and is interoperable with Java. Kotlin can also be used to create Android apps.</p>

<p>I was curious, so I decided to set up a small Android app using Kotlin and try out some different methods of testing.</p>

<h2 id="setting-up-the-app:c9e70ab1157400281b960b0c57a0d8d8">Setting up the app</h2>

<p>Setting up a hello word Android app in Kotlin was actually quite easy!  The Kotlin plugin for IntelliJ / Android Studo has a tool for converting your Java code to Kotlin, so you can get started really quickly! I was able to follow this <a href="https://kotlinlang.org/docs/tutorials/kotlin-android.html">tutorial</a> to get my Android app set up.</p>

<p>Two points to watch out for:</p>

<ol>
<li><p>Make sure you have installed the Kotlin plugins in Android Studio before you start</p></li>

<li><p>I had to highlight the text of my java file before selecting &ldquo;Convert Java File to Kotlin File&rdquo; in order to get the converter to work.</p></li>
</ol>

<h2 id="android-instrumentation-tests:c9e70ab1157400281b960b0c57a0d8d8">Android instrumentation tests</h2>

<p>I started by writing a simple Android Instrumentation test in Java (you can freely mix Java files and Kotlin files in your project and it seems to work fine).  Once that was working, I converted it to Kotlin:</p>

<pre><code class="language-kotlin">class MainActivityTest : ActivityInstrumentationTestCase2&lt;MainActivity&gt;(MainActivity::class.java) {
   private var mainActivity: Activity? = null

   @Throws(Exception::class)
   override fun setUp() {
       super.setUp()
       mainActivity = activity
   }

   fun test_itDisplaysHelloWorld() {
       val textView = mainActivity!!.findViewById(R.id.main_text) as TextView
       val actual = textView.text.toString()
       Assert.assertEquals(&quot;Hello World!&quot;, actual)
   }
}
</code></pre>

<p>The only trouble I had was that after I converted the file, the Android Studio test runner configuration was broken.  To fix it I had to edit my run configuration in Android Studio by navigating to <code>Run -&gt; Edit Configurations -&gt; Android Tests</code> and setting the instrumentation runner to <code>android.test.InstrumentationTestRunner</code>.  After that, lo and behold, the test worked fine in Kotlin!</p>

<h2 id="robolectric-tests:c9e70ab1157400281b960b0c57a0d8d8">Robolectric tests</h2>

<p>After my resounding success at getting the Android Instrumentation Tests to work, I decided to try my luck at Robolectric.  It turns out, Robolectric pretty much Just Worked too.  Here&rsquo;s a Robolectric test written in Kotlin, equivalent to the instrumentation test above:</p>

<pre><code class="language-kotlin">@RunWith(RobolectricGradleTestRunner::class)
@Config(constants = BuildConfig::class)
class ExampleRobolectricTest {

    @Test
    fun itShouldDisplayHelloWorld() {
        val activity = Robolectric.setupActivity(MainActivity::class.java)
        val textView = activity.findViewById(R.id.main_text) as TextView

        assertThat(textView.text).isEqualTo(&quot;Hello World!&quot;)
    }
}
</code></pre>

<h2 id="unit-tests-with-spek:c9e70ab1157400281b960b0c57a0d8d8">Unit tests with Spek</h2>

<p><a href="https://jetbrains.github.io/spek/">Spek</a> is a testing framwork written in Kotlin with a pretty, rspec-like syntax. I would love to be able to write my Android tests using something like Spek, so I decided to try!</p>

<h3 id="bad-news-1-android-instrumentation-tests-spek:c9e70ab1157400281b960b0c57a0d8d8">Bad news #1: Android Instrumentation tests + Spek</h3>

<p>Spek requires your tests to inherit from a base class called <code>Spek</code>.  Android instrumentation tests require your tests to inherit from <code>InstrumentationTestCase</code>.  As far as I can tell, this is a deal-breaker for using the two systems together, for the moment.</p>

<h3 id="bad-news-2-robolectric-tests-spek:c9e70ab1157400281b960b0c57a0d8d8">Bad news #2: Robolectric tests + Spek</h3>

<p>Robolectric doesn&rsquo;t specifically require your tests to inherit from any particular class, which theoretically opens the door to using it together with Spek.  However, naively combining them doesn&rsquo;t work as expected, as the test runner cannot find any tests.  I think the reason for this is that Robolectric relies on using the RobolectricTestRunner, which extends the <code>BlockJUnit4ClassRunner</code> (which identifies tests based on annotations), while Spek runs with it&rsquo;s own <code>JUnitClassRunner</code>.</p>

<p>In the future I may look into writing a RobolectricSpek test runner, but for now, it looks like these two systems do not play nicely together.</p>

<h3 id="finally-the-good-news:c9e70ab1157400281b960b0c57a0d8d8">Finally, the good news</h3>

<p>Although Spek does not seem to be compatible with either Robolectric or Android instrumentation tests, it actually works fine as a replacement for vanilla JUnit tests.  I think this kind of test is of dubious utility in a typical Android project, since there&rsquo;s usually not a lot of code that can be tested purely with JUnit, but if you have these kinds of tests, you could easily convert them to use Spek.  Here&rsquo;s a sample test I wrote in my hello world app:</p>

<pre><code class="language-kotlin">import org.jetbrains.spek.api.Spek
import kotlin.test.assertEquals

class ExampleUnitTest : Spek() {
    init {
        given(&quot;Two numbers&quot;) {
            val firstNumber = 3
            val secondNumber = 5
            on(&quot;adding the numbers&quot;) {
                val result = firstNumber + secondNumber
                it(&quot;should return the correct sum&quot;) {
                    assertEquals(8, result)
                }
            }
        }
    }
}
</code></pre>

<h2 id="conclusion:c9e70ab1157400281b960b0c57a0d8d8">Conclusion</h2>

<p>Kotlin seems like a promising new language with a lot of features that make it nicer to use than Java.  Setting up a &ldquo;Hello World&rdquo; Android app was extremely simple, and getting tests to run with Robolectric or the Android instrumentation runner was no problem.  I look forward to trying it out more in the future!</p>

      </div>
    </div>
  </div>
  <link rel="stylesheet" href="/css/highlight-github.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
